<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>حاسبة الخريطة الفلكية</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
        * { margin:0; padding:0; box-sizing:border-box; font-family: 'Cairo','Tahoma',sans-serif; }

        body{
            direction: rtl;
            min-height:100vh;
            padding:20px 15px;
            /* خلفية سماء الليل */
            background: linear-gradient(180deg, #1A233A 0%, #2A385C 100%);
            color:#333;
            position:relative;
            overflow-x:hidden;
        }
        
        /* تأثير النجوم */
        body::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            min-height: 1200px;
            background: transparent;
            box-shadow: 
                100px 100px 1px 1px #FFD700, 200px 300px 1px 1px #fff, 400px 500px 1px 1px #FFD700, 
                600px 100px 1px 1px #fff, 800px 400px 1px 1px #FFD700, 1000px 200px 1px 1px #fff, 
                1200px 500px 1px 1px #FFD700, 100px 800px 1px 1px #fff, 300px 900px 1px 1px #FFD700, 
                500px 700px 1px 1px #fff, 700px 600px 1px 1px #FFD700, 900px 800px 1px 1px #fff, 
                150px 500px 5px 5px rgba(255, 215, 0, 0.9),
                550px 800px 3px 3px rgba(255, 255, 255, 0.9), 
                950px 150px 5px 5px rgba(255, 215, 0, 0.9);
            z-index: 1; 
            opacity: 1;
        }

        .container { max-width:900px; width:100%; margin:0 auto; position:relative; z-index:2;
        }

        .header-section{
            padding: 40px 10px 30px;
            text-align: center;
            color: #F5F3FF;
        }
        .header-section h1{
            font-size:36px;
            font-weight:700; color:#F5F3FF;
            text-shadow: 0 0 8px rgba(255,255,255,0.12);
            margin-bottom:8px;
        }
        .header-section p{ color:#E8E1FF; max-width:600px;
            margin:0 auto; line-height:1.7; }

        .calculator-box{
            width:100%;
            max-width:700px; /* تقييد عرض الحاسبة */
            margin: 0 auto 40px;
            padding:28px;
            background: rgba(255,255,255,0.12); /* خلفية شفافة داخلية */
            border-radius:18px;
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 30px rgba(0,0,0,0.15);
            border:1px solid rgba(255,255,255,0.1);
        }
        .box-title{ 
            text-align:center; 
            color:#FFD700; /* لون ذهبي للعنوان */
            font-weight:700; 
            margin-bottom:20px;
            font-size: 24px;
            text-shadow: 0 0 5px rgba(255,215,0,0.5);
        }

        /* تنسيق النموذج */
        form { width:100%; margin:0; }
        .form-row { display:grid; grid-template-columns: repeat(4,1fr); gap:15px; margin-bottom:18px; }
        .form-row.double { grid-template-columns: 1fr 1fr; }
        .form-group { position:relative; }
        
        label { 
            display:block; 
            font-size:14px; 
            font-weight:700; 
            color:#F0F0F0; /* لون فاتح لتناسق الخلفية الداكنة */
            margin-bottom:6px;
        }
        
        input, select {
            width:100%;
            padding:12px; 
            border:1px solid #4A567A; 
            border-radius:8px;
            font-size:16px; 
            background:#1A233A; /* خلفية داكنة للحقول */
            color:#fff; 
            transition: box-shadow .2s, border-color .2s;
        }
        input:focus, select:focus { 
            outline:none; 
            border-color:#BA55D3; 
            box-shadow:0 0 10px rgba(186,85,211,0.5);
        }

        .btn{
            display:block;
            width:100%;
            padding:14px;
            border-radius:8px;
            border:none;
            /* تدرج لوني بنفسجي لامع */
            background: linear-gradient(90deg,#9370DB 0%,#BA55D3 100%);
            color:#fff; 
            font-size:20px; 
            font-weight:700; 
            cursor:pointer;
            margin-top:20px;
            box-shadow: 0 4px 15px rgba(186,85,211,0.4);
            transition: transform .18s, box-shadow .18s;
        }
        .btn:hover{ 
            transform: translateY(-2px); 
            box-shadow: 0 8px 25px rgba(186,85,211,0.6);
        }

        .error {
            color:#FFEBEE;
            background:#D32F2F; 
            padding:10px; 
            border-radius:8px;
            margin:15px auto; 
            max-width:600px; 
            font-weight:700; 
            border:1px solid #EF9A9A;
            text-align: center;
        }

        /* قسم النتائج */
        .result{ 
            max-width:900px; 
            margin:30px auto 60px; 
            background:rgba(255,255,255,0.98); 
            padding:25px; 
            border-radius:18px; 
            box-shadow:0 10px 30px rgba(0,0,0,0.1);
            border:1px solid #EEE; 
        }
        .info-box{ 
            background:#F0F4F8; 
            padding:15px; 
            border-radius:10px; 
            text-align:center; 
            color:#444; 
            margin-bottom:20px;
            font-size: 15px;
        }

        table{ 
            width:100%; 
            border-collapse:collapse; 
            font-size:15px; 
            margin-top:20px;
        }
        th, td{ 
            padding:12px 8px; 
            border:1px solid #E5E5E5; 
            text-align:center;
        }
        th{ 
            background:#E8E1FF; 
            color:#6A5ACD; 
            font-weight:700;
        }
        tr:nth-child(even) { 
            background:#F9F9F9;
        }
        tr:hover { 
            background:#F3F3F3;
        }

        .result h2, .result h3 { 
            color:#6A5ACD; 
            margin-top:30px; 
            margin-bottom:15px; 
            text-align:center;
            border-bottom: 2px solid #EEE;
            padding-bottom: 8px;
        }

        img { 
            display:block; 
            max-width:100%; 
            margin:25px auto; 
            border-radius:15px; 
            border:3px solid #6A5ACD;
            box-shadow:0 10px 30px rgba(0,0,0,0.1); 
        }

        .chart-placeholder {
            min-height: 250px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            background: #F0F4F8; /* لون فاتح للخلفية */
            color: #6A5ACD; /* لون بنفسجي للنص */
            border-radius: 15px;
            margin: 25px auto;
            border: 3px dashed #BA55D3; /* إطار متقطع بنفسجي */
            font-weight: 700;
            font-size: 18px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .chart-placeholder strong {
            display: block;
            margin-bottom: 10px;
            font-size: 20px;
        }

        .planet-symbol { 
            font-size:22px; 
            font-weight:700; 
            color:#FFD700;
        }

        .dst-notice {
            background:#FFF3CD;
            padding:15px; 
            border-radius:10px; 
            margin:15px 0;
            text-align:center; 
            color:#856404; 
            border:1px solid #FFEEBA;
            font-weight: bold;
        }

        /* تصميم الاستجابة */
        @media (max-width:768px){
            .header-section h1{ font-size:30px; }
            .calculator-box{ padding:20px; }
            .form-row{ grid-template-columns: repeat(2,1fr); gap:10px; }
            .form-row.double{ grid-template-columns: 1fr; }
            input, select, .btn{ padding:10px; font-size:16px; }
            th, td{ padding:8px 4px; font-size:13px; }
        }
        @media (max-width:480px){
            .form-row{ grid-template-columns:1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-section">
            <h1>اكتشف خريطتك الفلكية!</h1>
            <p>أدخل تفاصيل ميلادك الدقيقة (التاريخ، الوقت، والمكان) للحصول على تقرير فلكي شامل.</p>
        </div>

        <div class="calculator-box">
            <form method="post">
                <h2 class="box-title">🪐 حاسبة الخريطة الفلكية</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="day">اليوم:</label>
                        <input type="number" id="day" name="day" min="1" max="31" value="{{ input_data.day if input_data else '' }}" required>
                    </div>
                    <div class="form-group">
                        <label for="month">الشهر:</label>
                        <input type="number" id="month" name="month" min="1" max="12" value="{{ input_data.month if input_data else '' }}" required>
                    </div>
                    <div class="form-group">
                        <label for="year">السنة:</label>
                        <input type="number" id="year" name="year" value="{{ input_data.year if input_data else '' }}" required>
                    </div>
                    <div class="form-group">
                        <label for="house_system">نظام البيوت:</label>
                        <select id="house_system" name="house_system">
                            <option value="P" {% if input_data and input_data.get('house_system') == 'P' %}selected{% elif not input_data %}selected{% endif %}>بلاسيدوس</option>
                            <option value="W" {% if input_data and input_data.get('house_system') == 'W' %}selected{% endif %}>البرج الكامل</option>
                            <option value="E" {% if input_data and input_data.get('house_system') == 'E' %}selected{% endif %}>البيوت المتساوية</option>
                            <option value="K" {% if input_data and input_data.get('house_system') == 'K' %}selected{% endif %}>كوخ</option>
                        </select>
                    </div>
                </div>

                <div class="form-row double">
                    <div class="form-group">
                        <label for="hour">الساعة (24):</label>
                        <input type="number" id="hour" name="hour" min="0" max="23" value="{{ input_data.hour if input_data else '' }}" required>
                    </div>
                    <div class="form-group">
                        <label for="minute">الدقيقة:</label>
                        <input type="number" id="minute" name="minute" min="0" max="59" value="{{ input_data.minute if input_data else '' }}" required>
                    </div>
                </div>

                <div class="form-row double">
                    <div class="form-group">
                        <label for="city">المدينة:</label>
                        <input type="text" id="city" name="city" value="{{ input_data.city if input_data else '' }}" autocomplete="off" required>
                    </div>
                    <div class="form-group">
                        <label for="country">الدولة:</label>
                        <input type="text" id="country" name="country" value="{{ input_data.country if input_data else '' }}" required>
                    </div>
                </div>

                <button class="btn" type="submit">احسب خريطتي الفلكية</button>
            </form>

            {% if error %}
                <div class="error" style="margin-top:12px;">{{ error }}</div>
            {% endif %}
        </div>

        {% if result %}
        <div class="result">
            <h2>📍 نتائج الخريطة الفلكية لـ {{ result.location }}</h2>
            <div class="info-box">
                <strong>الوقت المحلي:</strong> {{ result.local_time }} |
                <strong>المنطقة الزمنية:</strong> {{ result.timezone }}<br>
                <strong>وقت UTC:</strong> {{ result.utc_time }}
            </div>

            {% if result.dst_notice %}
            <div class="dst-notice">{{ result.dst_notice }}</div>
            {% endif %}

            <h3>⭐ الزوايا الرئيسية</h3>
            <table>
                <tr>
                    <th>الزاوية</th><th>الاسم بالعربية</th><th>الدرجة الكلية</th><th>الدرجة في البرج</th><th>البرج</th><th>الرمز</th>
                </tr>
                {% for key, angle in result.angles.items() %}
                <tr>
                    <td><strong>{{ key }}</strong></td>
                    <td>{{ angle.name_ar }}</td>
                    <td>{{ "%.2f°"|format(angle.degree) }}</td>
                    <td>{{ "%.2f°"|format(angle.sign_info.degree_in_sign) }}</td>
                    <td>{{ angle.sign_info.sign_ar }}</td>
                    <td class="planet-symbol">{{ angle.sign_info.sign_symbol }}</td>
                </tr>
                {% endfor %}
            </table>

            <h3>🪐 مواقع الكواكب</h3>
            <table>
                <tr><th>الكوكب</th><th>الرمز</th><th>الدرجة الكلية</th><th>الدرجة في البرج</th><th>البرج</th><th>رمز البرج</th><th>البيت</th></tr>
                {% for planet in result.planets %}
                <tr>
                    <td>{{ planet.name_ar }}</td>
                    <td class="planet-symbol">{{ planet.symbol }}</td>
                    <td>{{ "%.2f°"|format(planet.degree) }}</td>
                    <td>{{ "%.2f°"|format(planet.degree_in_sign) }}</td>
                    <td>{{ planet.sign_ar }}</td>
                    <td class="planet-symbol">{{ planet.sign_symbol }}</td>
                    <td><strong>{{ planet.house }}</strong></td>
                </tr>
                {% endfor %}
            </table>

            <h3>🏠 البيوت الفلكية (نظام: {{ result.house_system }})</h3>
            <table>
                <tr><th>البيت</th><th>الاسم</th><th>الدرجة الكلية</th><th>الدرجة في البرج</th><th>البرج</th><th>الرمز</th></tr>
                {% for house in result.houses_info %}
                <tr>
                    <td><strong>{{ house.house }}</strong></td>
                    <td>{{ house.name_ar }}</td>
                    <td>{{ "%.2f°"|format(house.degree) }}</td>
                    <td>{{ "%.2f°"|format(house.degree_in_sign) }}</td>
                    <td>{{ house.sign_ar }}</td>
                    <!-- تم تصحيح الخطأ هنا: أصبح الوصول مباشرًا لـ sign_symbol -->
                    <td class="planet-symbol">{{ house.sign_symbol }}</td>
                </tr>
                {% endfor %}
            </table>

            <h3>🌌 الخريطة الفلكية المصورة</h3>
            {% if chart %}
                <img src="data:image/png;base64,{{ chart }}" alt="الخريطة الفلكية">
            {% else %}
                <div class="chart-placeholder">
                    <strong>⚠️ لا يمكن عرض الخريطة البيانية في العرض التمهيدي</strong><br>
                    سيتم إنشاء هذه الصورة بشكل ديناميكي بواسطة تطبيق Flask (Python) عند تشغيل التطبيق.
                </div>
            {% endif %}
        </div>
        {% endif %}
    </div>
    
</body>
</html>